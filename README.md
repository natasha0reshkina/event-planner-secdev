## P2 — Product Requirements: Авторизация

### Цель
Сформулировать требования к авторизации: вход/выход, регистрация, восстановление пароля, управление сессией, роли.

### Роли
- **Гость** — неавторизованный пользователь.
- **Пользователь** — авторизован, имеет доступ к личным данным/функциям.
- **Администратор** (опц.) — административные операции.

### User stories
- Как гость, я регистрируюсь по email/паролю, чтобы получить доступ к ЛК.
- Как пользователь, я вхожу по email/паролю и получаю доступ к своим данным.
- Как пользователь, я выхожу из аккаунта, чтобы завершить сессию.
- Как пользователь, я восстанавливаю пароль по email, если забыл его.
- Как пользователь, я автоматически продлеваю сессию через refresh токен.
- (Опц.) Как администратор, я вхожу в админ-панель.

### Флоу и API (черновик)
- `POST /auth/register` — { email, password } → 201 (опц. подтверждение email)
- `POST /auth/login` — { email, password } → { access, refresh }
- `POST /auth/refresh` — { refresh } → { access }
- `POST /auth/logout` — { refresh } → 204 (инвалидация)
- `POST /auth/forgot` — { email } → 202 (ссылка сброса)
- `POST /auth/reset` — { token, new_password } → 204
- `GET /me` — профиль по действующему `access` токену

### Валидации и ошибки
- Email валидный и уникальный; пароль ≥ 8 символов (описать правила).
- Коды: 400 (валидация), 401 (неверные креды/просроченный токен), 403 (нет прав), 429 (слишком много попыток).
- Сообщения без утечек: «Неверные логин или пароль».

### Безопасность
- Пароли хранить как хеш (bcrypt/argon2).
- JWT: `access` с коротким TTL (~15 мин), `refresh` с более длинным (7–30 дней).
- Выбрать модель хранения токенов: httpOnly+Secure cookie **или** заголовок; описать защиту от CSRF/XSS в выбранной модели.
- Rate limiting на логин/сброс; логи событий безопасности.

### Нефункциональные требования
- p95 логин/регистрация ≤ 300 мс.
- Метрики/логи успешных/неуспешных авторизаций.
- Не логировать персональные данные в явном виде.

### Тест-критерии
- Позитив: регистрация, логин, refresh, logout.
- Негатив: неверные креды, слабый пароль, просроченный токен.
- Доступ к `/me` только с валидным `access`.

> Связано с Issue #3
