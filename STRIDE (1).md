# STRIDE — Угрозы и контроли (Event Planner)

Ключевые NFR (ссылаемся из контролей):
- **NFR-01** AuthN (OIDC)
- **NFR-02** AuthZ (owner-only)
- **NFR-03** Валидация входных данных
- **NFR-04** Rate limiting
- **NFR-05** Transport security (TLS/mTLS)
- **NFR-06** Логирование и аудит
- **NFR-07** Управление секретами
- **NFR-08** Обработка/маскирование ошибок
- **NFR-09** Бэкапы/восстановление

| Поток/Элемент | Угроза (S/T/R/I/D/E) | Описание угрозы | Контроль | Ссылка на NFR | Проверка/Артефакт |
|---|---|---|---|---|---|
| F1 /login | **S** Spoofing | Подмена пользователя при аутентификации | OIDC (Auth Code + PKCE), опц. MFA, капча + rate limit | NFR-01, NFR-04 | e2e тест /login, ZAP baseline |
| F2 OIDC | **T** Tampering | Перехват/подмена кода авторизации | TLS 1.2+, PKCE verifier, короткий TTL | NFR-05 | Негативный e2e сценарий |
| F3 JWT к SVC | **R** Repudiation | Отказ от совершённых действий | Подписанный JWT (aud/iss/sub), audit trail | NFR-01, NFR-06 | Логи аудита, проверка полей JWT |
| F3/F6 API | **I** Info Disclosure | Утечка полей note/place через сеть | TLS, строгие CORS, минимизация полей | NFR-05, NFR-03 | Инспекция ответов; ZAP Passive |
| F4 DB | **T/D** Tampering/DoS | SQLi/массовые записи | Параметризованные запросы, лимиты, индексы | NFR-03, NFR-04 | gosec/sqlc отчёты; нагрузочные тесты |
| F5/F6 CRUD | **E** Elevation of Privilege | IDOR: доступ к чужим events | Owner-only policy, проверки на уровне SVC | NFR-02 | e2e негативы (чтение/удаление чужого ID) |
| SVC (валидация) | **T** | Обход валидации даты/длин | Серверная валидация, схемы (JSON Schema) | NFR-03 | Юнит‑тесты DTO, контракт‑тесты |
| F7 ICS | **I** | Публикация приватных notes в общем ICS | Экспорт только публичных полей; токен‑ссылка | NFR-02, NFR-03 | Снимок ICS, проверка полей |
| Errors | **I** | Детали ошибок наружу | Маскирование, маппинг кодов | NFR-08 | e2e: проверка тел ошибок |
| Secrets | **T/E** | Утечка ключей/JWT‑секрета | Vault/секрет‑хранилище, ротация | NFR-07 | Политики; секрет‑сканер в CI |
