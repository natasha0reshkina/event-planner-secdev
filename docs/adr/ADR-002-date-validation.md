# ADR-002: Валидация даты события
Дата: 2025-10-21

## Context
Создание событий с прошедшей датой недопустимо. При сравнении с текущим моментом возникали ложные запреты для событий на сегодняшний день. Требуется нормализовать сравнение.

## Decision
Дата события сравнивается с началом текущего дня по часовому поясу сервера.
Если дата меньше начала дня, возвращается код 422.
Дата, равная текущему дню, и будущая дата считаются допустимыми.

Порог и проверка:
не менее девяноста пяти процентов корректно отклоненных прошлых дат на наборе тестов,
модульные и сквозные тесты на прошлое, сегодня, будущее.

## Alternatives
Сравнение с текущим моментом.
Использование utc повсюду.
Сравнение с началом дня по локальному поясу.

## Consequences
Плюсы: предсказуемое поведение, отсутствие ложных запретов для сегодняшних событий.
Минусы: нужна фиксация часового пояса, тесты на переход суток.

## Security impact
Снижается риск логических ошибок и рассинхронизации данных расписания.
Сохраняется целостность доменной логики работы с датами.

## Rollout plan
Добавить проверку даты в создании и обновлении события.
Возвращать код 422 при ошибке.
Добавить тест tests/test_dates.py::test_rejects_past_date.
Проверить работу в разных зонах.

## Links
NFR-06 Валидация дат
tests/test_dates.py::test_rejects_past_date
