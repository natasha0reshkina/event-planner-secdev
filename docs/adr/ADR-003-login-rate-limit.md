# ADR-003: Ограничение частых ошибок входа
Дата: 2025-10-21

## Context
Многократные неудачные попытки входа увеличивают риск подбора паролей. Необходимо ограничить частоту входов и предусмотреть блокировку для злоупотреблений.  

## Decision
Вводится окно в десять минут на один IP-адрес.  
После пяти неудачных попыток входа пользователь блокируется на пятнадцать минут.  
Счётчик попыток и время блокировки хранятся в памяти приложения или базе данных.  
Пользователь получает понятное сообщение о временной блокировке.

Проверка:
- Не более пяти неудачных попыток входа за десять минут.  
- Шестая попытка в этом окне возвращает ошибку с пояснением.  
- Интеграционный тест подтверждает логику блокировки.

## Alternatives
1. **Капча** — усложняет интерфейс и требует внешнего сервиса.  
2. **Без ограничений** — небезопасно.  
3. **Rate limiting по IP и учёт блокировки** — оптимальный баланс простоты и эффективности.

## Consequences
**Плюсы:**  
- Защита от подбора паролей.  
- Простая реализация.  

**Минусы:**  
- Возможны ложные блокировки при общем IP.  
- Требуется очистка устаревших записей.

## Security impact
Снижает риск атак перебора паролей.  
Добавляет возможность быстрого выявления злоупотреблений и фиксации в журнале безопасности.

## Rollout plan
1. Реализовать счётчик неудачных попыток по IP.  
2. Добавить блокировку на 15 минут после превышения порога.  
3. Вернуть информативное сообщение о блокировке.  
4. Добавить тест `tests/test_login_limit.py::test_blocks_after_five_failures`.  
5. Проверить корректную разблокировку по истечении времени.

## Links
- NFR-09 Ограничение частых ошибок входа  
- F5, R3 из Threat Model  
- tests/test_login_limit.py::test_blocks_after_five_failures
